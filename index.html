<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VAF ID System</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      background-color: #121212;
      color: #E0E0E0;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 60px auto;
      padding: 40px;
      background-color: #1E1E1E;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.1);
    }
    h1, h2 {
      text-align: center;
      color: #4CAF50;
    }
    .status-message {
      margin: 20px 0;
      padding: 12px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 18px;
      display: inline-block;
      background-color: #222;
      color: #4CAF50;
      border: 1px solid #4CAF50;
    }
    .quick-links {
      text-align: center;
      margin: 30px 0;
    }
    .quick-links a {
      display: inline-block;
      margin: 10px 15px;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      color: #4CAF50;
    }
    .quick-links a:hover {
      text-decoration: underline;
    }
    .readme {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    .stats {
      margin-top: 40px;
      background-color: #2c2c2c;
      padding: 20px;
      border-radius: 10px;
    }
    .stats h3 {
      color: #4CAF50;
      margin-bottom: 12px;
    }
    .stats p {
      margin: 6px 0;
    }
    .auth-panel {
      text-align: center;
      margin-top: 30px;
    }
    .auth-panel button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>VAF ID System</h1>
    <p id="firebaseStatus" class="status-message">Checking Firebase connection...</p>

    <div class="quick-links">
      <a href="admin.html">Admin Panel</a>
      <a href="scanner.html">QR Scanner</a>
      <a href="index.html">Home</a>
    </div>

    <div id="authPanel" class="auth-panel">
      <button id="loginBtn">Login with Google</button>
    </div>

    <div id="userPanel" class="auth-panel" style="display:none;">
      <p>Logged in as <span id="userEmail"></span></p>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="infoContent" class="readme">
      <h2>Welcome</h2>
      <p><strong>VAF ID System</strong><br>
      This is a free, QR-based internal ID system for the Vojta Armed Forces.</p>
      <ul>
        <li>Hosted on GitHub Pages</li>
        <li>Uses Firebase Realtime Database</li>
        <li>Profiles created by admin only</li>
        <li>QR codes point to profile by numeric ID</li>
      </ul>
    </div>

    <div id="stats" class="stats" style="display: none;">
      <h3>System Stats</h3>
      <p>Total Profiles: <span id="totalCount">0</span></p>
      <p>Active: <span id="activeCount">0</span></p>
      <p>Wanted: <span id="wantedCount">0</span></p>
      <p>Blacklisted: <span id="blacklistedCount">0</span></p>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const statusEl = document.getElementById("firebaseStatus");
    const userPanel = document.getElementById("userPanel");
    const userEmailSpan = document.getElementById("userEmail");
    const loginBtn = document.getElementById("loginBtn");
    const authPanel = document.getElementById("authPanel");
    const statsBox = document.getElementById("stats");

    // Firebase status
    if (firebase.apps.length > 0) {
      statusEl.textContent = "✅ Firebase is connected!";
    } else {
      statusEl.textContent = "❌ Firebase failed to connect.";
      statusEl.style.color = "#E53935";
      statusEl.style.borderColor = "#E53935";
    }

    // Auth check
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        userEmailSpan.textContent = user.email;
        userPanel.style.display = "block";
        authPanel.style.display = "none";
        loadStats();
      } else {
        userPanel.style.display = "none";
        authPanel.style.display = "block";
        statsBox.style.display = "none";
      }
    });

    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .catch(err => alert("Login failed: " + err.message));
    };

    function logout() {
      firebase.auth().signOut().then(() => location.reload());
    }

    function loadStats() {
      const db = firebase.database();
      db.ref("profiles").once("value").then(snapshot => {
        const data = snapshot.val();
        if (!data) return;

        let total = 0, active = 0, wanted = 0, blacklisted = 0;

        Object.values(data).forEach(profile => {
          total++;
          const status = (profile.status || "").toLowerCase();
          if (status === "active") active++;
          if (status === "wanted") wanted++;
          if (status === "blacklisted") blacklisted++;
        });

        document.getElementById("totalCount").textContent = total;
        document.getElementById("activeCount").textContent = active;
        document.getElementById("wantedCount").textContent = wanted;
        document.getElementById("blacklistedCount").textContent = blacklisted;

        statsBox.style.display = "block";
      });
    }
  </script>
</body>
</html>
