<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - VAF ID System</title>

  <!-- QR Generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Login UI -->
  <div id="loginDiv">
    <p>Login with Google:</p>
    <button onclick="login()">Login</button>
  </div>

  <!-- Admin UI -->
  <div id="adminDiv" style="display:none;">
    <p>Welcome, admin!</p>
    <button onclick="logout()">Logout</button>

    <hr>
    <h3>Create VAF Profile</h3>
    <form id="createForm" onsubmit="createProfile(event)">
      <label>ID (numeric): <input type="number" id="idInput" required></label><br>
      <label>Username: <input type="text" id="usernameInput" required></label><br>
      <label>Real Name: <input type="text" id="realnameInput" required></label><br>
      <label>Rank: <input type="text" id="rankInput" required></label><br>
      <label>Department: <input type="text" id="departmentInput" required></label><br>
      <label>Access Level: <input type="number" id="accessInput" min="0" max="9" required></label><br>
      <label>Join Date: <input type="date" id="joindateInput" required></label><br>
      <label>Status:
        <select id="statusInput">
          <option>active</option>
          <option>inactive</option>
          <option>wanted</option>
        </select>
      </label><br>
      <label>Icon URL: <input type="url" id="iconInput"></label><br><br>
      <button type="submit">✅ Create Profile</button>
    </form>
    <p id="resultMsg"></p>

    <hr>
    <h3>QR Code for Last Created ID</h3>
    <div id="qrcode"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginDiv').style.display = 'none';
        document.getElementById('adminDiv').style.display = 'block';
      } else {
        document.getElementById('loginDiv').style.display = 'block';
        document.getElementById('adminDiv').style.display = 'none';
      }
    });

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(result => {
          console.log("Logged in as:", result.user.email);
        })
        .catch(error => {
          alert("Login failed: " + error.message);
        });
    }

    function logout() {
      firebase.auth().signOut();
    }

    function createProfile(event) {
      event.preventDefault();

      const id = document.getElementById("idInput").value;
      const profile = {
        username: document.getElementById("usernameInput").value,
        realName: document.getElementById("realnameInput").value,
        rank: document.getElementById("rankInput").value,
        department: document.getElementById("departmentInput").value,
        accessLevel: parseInt(document.getElementById("accessInput").value),
        joinDate: document.getElementById("joindateInput").value,
        status: document.getElementById("statusInput").value,
        icon: document.getElementById("iconInput").value || ""
      };

      firebase.database().ref("profiles/" + id).set(profile)
        .then(() => {
          document.getElementById("resultMsg").textContent = `✅ Profile ${id} created successfully!`;
          document.getElementById("createForm").reset();

          const qrDiv = document.getElementById("qrcode");
          qrDiv.innerHTML = "";
          new QRCode(qrDiv, {
            text: id,
            width: 150,
            height: 150
          });
        })
        .catch(error => {
          document.getElementById("resultMsg").textContent = `❌ Failed: ${error.message}`;
        });
    }
  </script>
</body>
</html>
